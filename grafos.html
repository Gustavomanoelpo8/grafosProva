<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Grafo Visual</title>
    <style>
      canvas {
        border: 1px solid black;
        margin-bottom: 10px;
      }
      button {
        display: block;
        margin: 6px 0;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <canvas id="canvas" width="800" height="500"></canvas>
      <div id="matriz-output" style="margin-top: 20px"></div>

      <button id="btnMatriz">Gerar Matriz</button>
      <button id="btnCaminhos">Percorrer Caminho</button>
      <pre id="resultado" style="white-space: pre-wrap; margin-top: 10px"></pre>

      <button id="btnCriarManual">Criar Grafo Manualmente</button>
      <button id="btnExemploDijkstra">Carregar Exemplo Dijkstra</button>
    </div>

    <script>
      class Grafo {
        constructor() {
          this.ordem = 50;
          this.matriz = Array.from({ length: this.ordem }, () =>
            Array(this.ordem).fill(0)
          );
          this.pesos = Array.from({ length: this.ordem }, () =>
            Array(this.ordem).fill(0)
          );
          this.nomes = [];
          this.coordenadas = [];
        }

        adicionarVertice(nome, x, y) {
          if (
            nome &&
            !this.nomes.includes(nome) &&
            this.nomes.length < this.ordem
          ) {
            this.nomes.push(nome);
            this.coordenadas.push({ x, y });
            return true;
          }
          alert("Nome inválido ou já existente!");
          return false;
        }

        AdicionarAresta(origem, destino, peso = 1) {
          const i_origem = this.nomes.indexOf(origem);
          const i_destino = this.nomes.indexOf(destino);

          if (i_origem !== -1 && i_destino !== -1 && i_origem !== i_destino) {
            this.matriz[i_origem][i_destino] = peso;
            this.matriz[i_destino][i_origem] = peso;
            this.pesos[i_origem][i_destino] = peso;
            this.pesos[i_destino][i_origem] = peso;
          }
        }

        gerarMatrizAdjacencia() {
          const matrizDiv = document.getElementById("matriz-output");
          let tabela =
            "<h3>Matriz de Adjacência</h3><table border='1' cellpadding='5' cellspacing='0' style='border-collapse: collapse; text-align: center;'>";

          tabela += "<tr><th></th>";
          this.nomes.forEach((nome) => {
            tabela += `<th>${nome}</th>`;
          });
          tabela += "</tr>";

          for (let i = 0; i < this.nomes.length; i++) {
            tabela += `<tr><th>${this.nomes[i]}</th>`;
            for (let j = 0; j < this.nomes.length; j++) {
              const valor = this.matriz[i][j];
              tabela += `<td>${valor === 0 ? 0 : valor}</td>`;
            }
            tabela += "</tr>";
          }

          tabela += "</table>";
          matrizDiv.innerHTML = tabela;
        }

        encontrarTodosCaminhos(origem, destino) {
          const caminhos = [];
          const visitado = Array(this.nomes.length).fill(false);
          const caminhoAtual = [];

          const dfs = (atual) => {
            const i_atual = this.nomes.indexOf(atual);
            visitado[i_atual] = true;
            caminhoAtual.push(atual);

            if (atual === destino) {
              caminhos.push([...caminhoAtual]);
            } else {
              for (let i = 0; i < this.nomes.length; i++) {
                if (this.matriz[i_atual][i] !== 0 && !visitado[i]) {
                  dfs(this.nomes[i]);
                }
              }
            }

            caminhoAtual.pop();
            visitado[i_atual] = false;
          };

          dfs(origem);
          return caminhos;
        }

        criarGrafoManual(dados) {
          const nomesUnicos = [
            ...new Set(
              dados
                .map((d) => d.nome)
                .concat(...dados.flatMap((d) => d.arestas))
            ),
          ];
          this.nomes = nomesUnicos;
          this.coordenadas = [];
          this.matriz = Array.from({ length: this.ordem }, () =>
            Array(this.ordem).fill(0)
          );
          this.pesos = Array.from({ length: this.ordem }, () =>
            Array(this.ordem).fill(0)
          );

          nomesUnicos.forEach((nome, i) => {
            const angulo = (2 * Math.PI * i) / nomesUnicos.length;
            const raio = 180;
            const centroX = canvas.width / 2;
            const centroY = canvas.height / 2;
            const x = centroX + raio * Math.cos(angulo);
            const y = centroY + raio * Math.sin(angulo);
            this.coordenadas.push({ x, y });
          });

          dados.forEach((vertice) => {
            const origemIndex = this.nomes.indexOf(vertice.nome);
            vertice.arestas.forEach((destinoNome) => {
              const destinoIndex = this.nomes.indexOf(destinoNome);
              if (
                origemIndex !== -1 &&
                destinoIndex !== -1 &&
                origemIndex !== destinoIndex
              ) {
                this.AdicionarAresta(
                  this.nomes[origemIndex],
                  this.nomes[destinoIndex],
                  1
                );
              }
            });
          });
        }
      }

      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const grafo = new Grafo();
      let caminhoMaisCurto = null;
      let caminhoMaisLongo = null;

      function desenharVertice(x, y, nome) {
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, 2 * Math.PI);
        ctx.fillStyle = "lightblue";
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.stroke();
        ctx.fillStyle = "black";
        ctx.font = "14px Arial";
        ctx.fillText(nome, x - 10, y + 5);
      }

      function redesenharTudo() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < grafo.nomes.length; i++) {
          for (let j = i + 1; j < grafo.nomes.length; j++) {
            if (grafo.matriz[i][j] !== 0) {
              const p1 = grafo.coordenadas[i];
              const p2 = grafo.coordenadas[j];

              ctx.beginPath();
              ctx.moveTo(p1.x, p1.y);
              ctx.lineTo(p2.x, p2.y);
              ctx.strokeStyle = "black";
              ctx.lineWidth = 2;
              ctx.stroke();

              const peso = grafo.pesos[i][j];
              const meioX = (p1.x + p2.x) / 2;
              const meioY = (p1.y + p2.y) / 2;
              ctx.fillStyle = "black";
              ctx.font = "12px Arial";
              ctx.fillText(peso, meioX, meioY);
            }
          }
        }

        for (let i = 0; i < grafo.nomes.length; i++) {
          const v = grafo.coordenadas[i];
          desenharVertice(v.x, v.y, grafo.nomes[i]);
        }

        const desenharCaminho = (caminho, cor) => {
          ctx.strokeStyle = cor;
          ctx.lineWidth = 3;
          for (let i = 0; i < caminho.length - 1; i++) {
            const i1 = grafo.nomes.indexOf(caminho[i]);
            const i2 = grafo.nomes.indexOf(caminho[i + 1]);
            const p1 = grafo.coordenadas[i1];
            const p2 = grafo.coordenadas[i2];
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
          }
        };

        if (caminhoMaisCurto) desenharCaminho(caminhoMaisCurto, "blue");
        if (caminhoMaisLongo) desenharCaminho(caminhoMaisLongo, "red");
      }

      let selecionado = null;

      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const xClick = e.clientX - rect.left;
        const yClick = e.clientY - rect.top;
        const raio = 20;
        let indiceVerticeClicado = null;

        for (let i = 0; i < grafo.coordenadas.length; i++) {
          const vertice = grafo.coordenadas[i];
          const dx = xClick - vertice.x;
          const dy = yClick - vertice.y;
          if (Math.sqrt(dx * dx + dy * dy) <= raio) {
            indiceVerticeClicado = i;
            break;
          }
        }

        if (indiceVerticeClicado !== null) {
          if (selecionado === null) {
            selecionado = indiceVerticeClicado;
            alert(`Vértice '${grafo.nomes[selecionado]}' selecionado.`);
          } else if (indiceVerticeClicado !== selecionado) {
            const pesoStr = prompt("Peso da aresta:", "1");
            const peso = parseFloat(pesoStr);
            if (!isNaN(peso) && peso > 0) {
              grafo.AdicionarAresta(
                grafo.nomes[selecionado],
                grafo.nomes[indiceVerticeClicado],
                peso
              );
              selecionado = null;
              redesenharTudo();
            } else {
              alert("Peso inválido.");
              selecionado = null;
            }
          }
        } else {
          const nome = prompt("Nome do novo vértice:");
          if (nome && grafo.adicionarVertice(nome.trim(), xClick, yClick)) {
            desenharVertice(xClick, yClick, nome.trim());
          }
        }
      });

      document.getElementById("btnMatriz").addEventListener("click", () => {
        grafo.gerarMatrizAdjacencia();
      });

      document.getElementById("btnCaminhos").addEventListener("click", () => {
        const origem = prompt("Origem:");
        const destino = prompt("Destino:");

        if (!grafo.nomes.includes(origem) || !grafo.nomes.includes(destino)) {
          alert("Vértice inválido.");
          return;
        }

        const caminhos = grafo.encontrarTodosCaminhos(origem, destino);
        if (caminhos.length === 0) {
          alert("Nenhum caminho encontrado.");
          return;
        }

        let resposta = `Caminhos de ${origem} até ${destino}:\n`;

        const pesos = [];

        caminhos.forEach((caminho) => {
          let pesoTotal = 0;
          for (let i = 0; i < caminho.length - 1; i++) {
            const i1 = grafo.nomes.indexOf(caminho[i]);
            const i2 = grafo.nomes.indexOf(caminho[i + 1]);
            pesoTotal += grafo.pesos[i1][i2];
          }
          pesos.push(pesoTotal);
          resposta += `• ${caminho.join(" → ")} (Peso total: ${pesoTotal})\n`;
        });

        const min = Math.min(...pesos);
        const max = Math.max(...pesos);
        const caminhoMaisCurto = caminhos[pesos.indexOf(min)];
        const caminhoMaisLongo = caminhos[pesos.indexOf(max)];

        resposta += `\n🔹 Mais curto: ${caminhoMaisCurto.join(
          " → "
        )} (Peso total: ${min})`;
        resposta += `\n🔸 Mais longo: ${caminhoMaisLongo.join(
          " → "
        )} (Peso total: ${max})`;

        document.getElementById("resultado").textContent = resposta;
      });

      document
        .getElementById("btnCriarManual")
        .addEventListener("click", () => {
          const quantidade = Number(prompt("Quantos vértices deseja criar?"));
          if (isNaN(quantidade) || quantidade <= 0)
            return alert("Número inválido.");

          const dadosVertices = [];

          for (let i = 0; i < quantidade; i++) {
            const nome = prompt(`Nome do vértice ${i + 1}:`).trim();
            if (!nome) return alert("Nome inválido.");

            const arestas = [];
            while (true) {
              const destino = prompt(
                `Com qual vértice '${nome}' se conecta? (vazio para parar)`
              );
              if (!destino) break;
              arestas.push(destino.trim());
            }

            dadosVertices.push({ nome, arestas });
          }

          grafo.criarGrafoManual(dadosVertices);
          caminhoMaisCurto = null;
          caminhoMaisLongo = null;
          redesenharTudo();
        });

      document
        .getElementById("btnExemploDijkstra")
        .addEventListener("click", () => {
          grafo.nomes = ["A", "B", "C", "D", "E", "F"];
          grafo.coordenadas = [
            { x: 100, y: 250 },
            { x: 250, y: 100 },
            { x: 250, y: 400 },
            { x: 450, y: 100 },
            { x: 450, y: 400 },
            { x: 600, y: 250 },
          ];

          grafo.matriz = Array.from({ length: grafo.ordem }, () =>
            Array(grafo.ordem).fill(0)
          );
          grafo.pesos = Array.from({ length: grafo.ordem }, () =>
            Array(grafo.ordem).fill(0)
          );

          grafo.AdicionarAresta("A", "B", 12);
          grafo.AdicionarAresta("A", "C", 4);
          grafo.AdicionarAresta("B", "C", 6);
          grafo.AdicionarAresta("C", "B", 10);
          grafo.AdicionarAresta("B", "D", 6);
          grafo.AdicionarAresta("B", "E", 8);
          grafo.AdicionarAresta("C", "E", 2);
          grafo.AdicionarAresta("D", "F", 6);
          grafo.AdicionarAresta("E", "F", 6);

          caminhoMaisCurto = null;
          caminhoMaisLongo = null;
          redesenharTudo();
        });
    </script>
  </body>
</html>
